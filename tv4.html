<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>צפייה בערוצים</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #1F2937;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .video-container {
      position: relative;
      aspect-ratio: 16 / 9;
      border-radius: 12px;
      overflow: hidden;
      background: black;
    }
    .controls-container {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 10;
      opacity: 0;
      transition: 0.3s ease;
    }
    .video-container:hover .controls-container {
      opacity: 1;
    }
    .sound-toggle, .fullscreen-toggle {
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      background: #374151;
      color: white;
    }
    .sound-toggle.on { background: #10B981; }
    .sound-toggle.off { background: #EF4444; }
    .fullscreen-toggle.active { background: #4F46E5; }
    .channel-name-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.6);
      text-align: center;
      padding: 4px;
      font-size: 14px;
    }
    .channel-button {
      background: #4B5563;
      padding: 8px 14px;
      border-radius: 8px;
      font-weight: bold;
      margin: 4px;
    }
    .channel-button:hover { background: #6B7280; }
    .channel-button.active { background: #2563EB; }
  </style>
</head>
<body>

<h1 class="text-2xl font-bold text-center mb-6">שידורים חיים</h1>

<div id="channel-buttons" class="flex flex-wrap justify-center mb-6"></div>
<div id="video-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

<script>
const channels = {
  now14_muted1: {
    name: "ערוץ 14 (muted=1)",
    type: "iframe",
    url: "https://snippet.univtec.com/player.html",
    muteParam: "muted",
    muteValue: "1"
  },
  now14_mutedTrue: {
    name: "ערוץ 14 (muted=true)",
    type: "iframe",
    url: "https://snippet.univtec.com/player.html",
    muteParam: "muted",
    muteValue: "true"
  },
  now14_volume0: {
    name: "ערוץ 14 (volume=0)",
    type: "iframe",
    url: "https://snippet.univtec.com/player.html",
    muteParam: "volume",
    muteValue: "0"
  },
  kan11: {
    name: "כאן 11",
    type: "hls",
    url: "https://kan11w.media.kan.org.il/hls/live/2105694/2105694/source1_4k/chunklist.m3u8"
  },
  news13: {
    name: "חדשות 13",
    type: "hls",
    url: "https://d198ztbnlup2iq.cloudfront.net/out/v1/2d9050c90fb94df8b78d1d98306a1a65/index.m3u8"
  },
  news12: {
    name: "חדשות 12",
    type: "iframe",
    url: "https://www.mako.co.il/AjaxPage?jspName=embedHTML5video.jsp&galleryChannelId=798cfb1e06667910VgnVCM200000650a10acRCRD&videoChannelId=7690b3a2a4ac5910VgnVCM200000650a10acRCRD&vcmid=003432e70df02310VgnVCM100000290b320aRCRD",
    muteParam: "muted",
    muteValue: "true"
  }
};

let active = [];
let activeAudioKey = null;

const grid = document.getElementById("video-grid");
const channelButtonsContainer = document.getElementById("channel-buttons");

function buildUrl(base, muted, muteParam = "muted", muteValue = null) {
  try {
    const url = new URL(base);
    if (muteParam) {
      const val = muteValue ?? (muted ? "true" : "false");
      url.searchParams.set(muteParam, val);
    }
    url.searchParams.set("autoplay", "true");
    return url.toString();
  } catch (e) {
    console.error("Invalid URL:", base);
    return base;
  }
}

function render() {
  grid.innerHTML = "";
  active.forEach((key) => {
    const ch = channels[key];
    const box = document.createElement("div");
    box.className = "video-container";

    let el;
    const hasAudio = key === activeAudioKey;

    if (ch.type === "hls") {
      el = document.createElement("video");
      el.className = "w-full h-full";
      el.autoplay = true;
      el.controls = true;
      el.muted = !hasAudio;
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(ch.url);
        hls.attachMedia(el);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          el.play().catch(() => {});
        });
      } else {
        el.src = ch.url;
        el.play().catch(() => {});
      }
    } else {
      el = document.createElement("iframe");
      el.className = "w-full h-full";
      el.allow = "autoplay; fullscreen";
      el.allowFullscreen = true;
      el.src = buildUrl(ch.url, !hasAudio, ch.muteParam, ch.muteValue);
    }

    const controls = document.createElement("div");
    controls.className = "controls-container";

    const soundBtn = document.createElement("button");
    soundBtn.className = `sound-toggle ${hasAudio ? "on" : "off"}`;
    soundBtn.textContent = hasAudio ? "🔊 השתק" : "🔇 שמע";
    soundBtn.onclick = () => {
      activeAudioKey = hasAudio ? null : key;
      render();
    };

    controls.appendChild(soundBtn);

    const label = document.createElement("div");
    label.className = "channel-name-bar";
    label.textContent = ch.name;

    box.append(el, controls, label);
    grid.appendChild(box);
  });

  updateButtons();
}

function updateButtons() {
  document.querySelectorAll(".channel-button").forEach((btn) => {
    const key = btn.dataset.channel;
    btn.classList.toggle("active", active.includes(key));
    btn.textContent = channels[key].name + (activeAudioKey === key ? " 🔊" : active.includes(key) ? " ✅" : "");
  });
}

function createChannelButtons() {
  Object.keys(channels).forEach((key) => {
    const btn = document.createElement("button");
    btn.className = "channel-button";
    btn.dataset.channel = key;
    btn.textContent = channels[key].name;
    btn.onclick = () => {
      if (active.includes(key)) {
        active = active.filter((k) => k !== key);
        if (activeAudioKey === key) activeAudioKey = null;
      } else {
        active.push(key);
      }
      render();
    };
    channelButtonsContainer.appendChild(btn);
  });
}

createChannelButtons();
render();
</script>

</body>
</html>

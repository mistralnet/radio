<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>צפייה בערוצים</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J5WT91REYB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J5WT91REYB');
  </script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #1F2937; color: white; font-family: sans-serif; margin: 0; }
    .video-container { position: relative; aspect-ratio: 16/9; border-radius: 8px; overflow: hidden; }
    .sound-toggle { position: absolute; top: 50%; left: 10px; transform: translateY(-50%); background: rgba(0,0,0,0.6); padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; display: none; }
    .video-container:hover .sound-toggle { display: inline-block; }
    .sound-toggle.on { background: #10B981; }
    .sound-toggle.off { background: #EF4444; }
    .channel-button { padding: 10px 20px; border-radius: 8px; background: #4B5563; transition: 0.2s; font-weight: bold; }
    .channel-button:hover { background: #6B7280; }
    .channel-button.active { background: #1F6FEB; transform: translateY(-2px); }
  </style>
</head>
<body class="p-4">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P5QLH7TD" height="0" width="0" style="display:none"></iframe></noscript>

<h1 class="text-2xl font-bold text-center mb-4">צפייה בערוצים</h1>
<div class="flex justify-center gap-3 flex-wrap mb-6">
  <button class="channel-button" data-channel="kan11">כאן 11</button>
  <button class="channel-button" data-channel="now14">עכשיו 14</button>
  <button class="channel-button" data-channel="i24news">i24NEWS</button>
  <button class="channel-button" data-channel="news13">חדשות 13</button>
  <button class="channel-button" data-channel="news12">חדשות 12</button>
</div>

<div id="video-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
<p id="no-channel-message" class="text-center text-gray-300 mt-6 hidden">יש לבחור ערוץ מהכפתורים מעלה</p>

<script>
const channels = {
  kan11: { type: 'hls', url: 'https://kan11w.media.kan.org.il/hls/live/2105694/2105694/source1_4k/chunklist.m3u8' },
  now14: { type: 'iframe', url: 'https://snippet.univtec.com/player.html?data-insight=eyJndWlkIjoiYjY3NmI5MDYtNTYyNS00OGFmLWEzMzEtMTFhNWQyMmUxNTFiIiwidHlwZSI6ImNoYW5uZWxzIiwiYWNjb3VudElkIjoiNjM5Nzc1M2ZmZjg3MTk3YWU2YTNjMDMiLCJjbGllbnQiOiJjaGFubmVsMTQiLCJhcGkiOiJodHRwczovL2luc2lnaHQtYXBpLWNoYW5uZWwxNC51bml2dGVjLmNvbS8ifQ==' },
  i24news: { type: 'hls', url: 'https://bcovlive-a.akamaihd.net/d89ede8094c741b7924120b27764153c/eu-central-1/5377161796001/profile_0/chunklist.m3u8' },
  news13: { type: 'hls', url: 'https://d198ztbnlup2iq.cloudfront.net/out/v1/2d9050c90fb94df8b78d1d98306a1a65/index.m3u8' },
  news12: { type: 'iframe', url: 'https://www.mako.co.il/AjaxPage?jspName=embedHTML5video.jsp&galleryChannelId=798cfb1e06667910VgnVCM200000650a10acRCRD&videoChannelId=7690b3a2a4ac5910VgnVCM200000650a10acRCRD&vcmid=003432e70df02310VgnVCM100000290b320aRCRD' }
};

let active = [];
let activeAudioKey = null;
const grid = document.getElementById('video-grid');
const message = document.getElementById('no-channel-message');

function buildUrl(base, muted) {
  const sep = base.includes('?') ? '&' : '?';
  return `${base}${sep}autoplay=1&muted=${muted ? 1 : 0}`;
}

function render() {
  grid.innerHTML = '';
  message.classList.toggle('hidden', active.length > 0);
  active.forEach(key => {
    const ch = channels[key];
    const box = document.createElement('div');
    box.className = 'video-container';

    let el;
    const hasAudio = key === activeAudioKey;
    if (ch.type === 'hls') {
      el = document.createElement('video');
      el.className = 'w-full h-full';
      el.autoplay = true; el.controls = true; el.muted = !hasAudio;
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(ch.url);
        hls.attachMedia(el);
      } else {
        el.src = ch.url;
      }
    } else {
      el = document.createElement('iframe');
      el.src = buildUrl(ch.url, !hasAudio);
      el.className = 'w-full h-full';
      el.allow = 'autoplay; fullscreen';
    }

    const btn = document.createElement('button');
    btn.className = `sound-toggle ${hasAudio ? 'on' : 'off'}`;
    btn.textContent = hasAudio ? '🔊 השתק' : '🔇 שמע';
    btn.onclick = e => {
      e.stopPropagation();
      activeAudioKey = hasAudio ? null : key;
      render();
    };

    box.append(el, btn);
    grid.appendChild(box);
  });
}

document.querySelectorAll('.channel-button').forEach(btn => {
  const key = btn.dataset.channel;
  btn.onclick = () => {
    if (active.includes(key)) {
      active = active.filter(k => k !== key);
      if (activeAudioKey === key) activeAudioKey = null;
      btn.classList.remove('active');
    } else {
      active.unshift(key);
      btn.classList.add('active');
    }
    render();
  };
});

render();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="he">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J5WT91REYB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-J5WT91REYB');
    </script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-P5QLH7TD');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>צפייה בערוצים - גרסה מתוקנת</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            direction: rtl;
            background: linear-gradient(135deg, #1F2937 0%, #374151 100%);
            color: white;
            margin: 0;
            font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }
        
        .video-container {
            position: relative;
            aspect-ratio: 16 / 9;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            background: #000;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .video-container:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .video-container.has-audio {
            border-color: #10B981;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        }
        
        .video-container.has-audio:hover {
            box-shadow: 0 12px 40px rgba(16, 185, 129, 0.4);
        }
        
        .video-container video,
        .video-container iframe {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        
        .audio-indicator {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        
        .video-container.has-audio .audio-indicator {
            display: flex;
        }
        
        .channel-name {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        .grid-container {
            display: grid;
            gap: 20px;
            margin: 0 auto;
            max-width: 100%;
            padding: 0 20px;
        }
        
        .channel-button {
            padding: 14px 24px;
            background: linear-gradient(135deg, #4B5563 0%, #6B7280 100%);
            color: white;
            border: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            flex: 1 1 140px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 50px;
        }
        
        .channel-button.active {
            background: linear-gradient(135deg, #059669 0%, #10B981 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }
        
        .channel-button:hover {
            background: linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .channel-button.active:hover {
            background: linear-gradient(135deg, #047857 0%, #059669 100%);
        }
        
        .control-panel {
            background: rgba(55, 65, 81, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .mute-all-button {
            background: linear-gradient(135deg, #DC2626 0%, #EF4444 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        
        .mute-all-button:hover {
            background: linear-gradient(135deg, #B91C1C 0%, #DC2626 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }
        
        .mute-all-button.all-muted {
            background: linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%);
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
        }
        
        .mute-all-button.all-muted:hover {
            background: linear-gradient(135deg, #4B5563 0%, #6B7280 100%);
            box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
        }
        
        @media (min-width: 768px) {
            .grid-1 { grid-template-columns: 1fr; }
            .grid-2 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(3, 1fr); }
            .grid-4 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, auto); }
            .grid-5 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, auto); }
        }
        
        @media (max-width: 767px) {
            .grid-container {
                grid-template-columns: 1fr;
            }
            .channel-button {
                font-size: 14px;
                padding: 12px 20px;
            }
        }
        
        .footer-container {
            background: rgba(45, 55, 72, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            margin: 40px 20px 20px;
            border: 1px solid rgba(74, 85, 104, 0.3);
        }
        
        .footer-link-button {
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .footer-link-button:hover {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }
        
        .no-channel-message {
            text-align: center;
            color: #CBD5E0;
            margin: 40px 0;
            font-size: 18px;
            font-weight: 500;
            background: rgba(55, 65, 81, 0.5);
            padding: 24px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .iframe-warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: #FCD34D;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body class="p-4">
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P5QLH7TD" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-400 to-green-400 bg-clip-text text-transparent">
            צפייה בערוצים
        </h1>
        <p class="text-gray-300 text-lg">בחר ערוצים לצפייה ולחץ על ערוץ כדי להפעיל/לכבות את השמע</p>
    </div>

    <div class="control-panel">
        <div class="flex flex-col sm:flex-row gap-4 items-center justify-between">
            <div class="flex flex-wrap justify-center gap-3 flex-1">
                <button class="channel-button" data-channel="kan11">
                    <i class="fas fa-tv"></i>
                    כאן 11
                </button>
                <button class="channel-button" data-channel="now14">
                    <i class="fas fa-broadcast-tower"></i>
                    עכשיו 14
                </button>
                <button class="channel-button" data-channel="i24news">
                    <i class="fas fa-globe"></i>
                    i24NEWS
                </button>
                <button class="channel-button" data-channel="news13">
                    <i class="fas fa-newspaper"></i>
                    חדשות 13
                </button>
                <button class="channel-button" data-channel="news12">
                    <i class="fas fa-satellite-dish"></i>
                    חדשות 12
                </button>
            </div>
            
            <button id="mute-all-btn" class="mute-all-button all-muted">
                <i class="fas fa-volume-mute"></i>
                השתק הכל
            </button>
        </div>
        
        <div class="iframe-warning">
            <i class="fas fa-info-circle"></i>
            <span>הערה: ערוץ 12 ועכשיו 14 עשויים להתחיל עם שמע למרות הגדרות השתקה בגלל מגבלות טכניות</span>
        </div>
    </div>

    <div id="video-grid" class="grid-container"></div>
    <div id="no-channel-message" class="no-channel-message" style="display: none;">
        <i class="fas fa-tv text-4xl mb-4 opacity-50"></i>
        <br>
        יש לבחור ערוץ מהכפתורים למעלה כדי להתחיל לצפות
    </div>

    <script>
        const channels = {
            kan11: { 
                type: 'hls', 
                url: 'https://kan11w.media.kan.org.il/hls/live/2105694/2105694/source1_4k/chunklist.m3u8',
                name: 'כאן 11'
            },
            now14: { 
                type: 'iframe', 
                url: 'https://snippet.univtec.com/player.html?data-insight=eyJndWlkIjoiYjY3NmI5MDYtNTYyNS00OGFmLWEzMzEtMTFhNWQyMmUxNTFiIiwidHlwZSI6ImNoYW5uZWxzIiwiYWNjb3VudElkIjoiNjM5Nzc1M2ZmZjg3MTk3YWU2YTNjMDMiLCJjbGllbnQiOiJjaGFubmVsMTQiLCJhcGkiOiJodHRwczovL2luc2lnaHQtYXBpLWNoYW5uZWwxNC51bml2dGVjLmNvbS8ifQ==',
                name: 'עכשיו 14'
            },
            i24news: { 
                type: 'hls', 
                url: 'https://bcovlive-a.akamaihd.net/d89ede8094c741b7924120b27764153c/eu-central-1/5377161796001/profile_0/chunklist.m3u8',
                name: 'i24NEWS'
            },
            news13: { 
                type: 'hls', 
                url: 'https://d198ztbnlup2iq.cloudfront.net/out/v1/2d9050c90fb94df8b78d1d98306a1a65/index.m3u8',
                name: 'חדשות 13'
            },
            news12: { 
                type: 'iframe', 
                url: 'https://www.mako.co.il/AjaxPage?jspName=embedHTML5video.jsp&galleryChannelId=798cfb1e06667910VgnVCM200000650a10acRCRD&videoChannelId=7690b3a2a4ac5910VgnVCM200000650a10acRCRD&vcmid=003432e70df02310VgnVCM100000290b320aRCRD',
                name: 'חדשות 12'
            }
        };

        const grid = document.getElementById('video-grid');
        const buttons = document.querySelectorAll('.channel-button');
        const muteAllBtn = document.getElementById('mute-all-btn');
        const noChannelMessage = document.getElementById('no-channel-message');
        
        let active = JSON.parse(localStorage.getItem('activeChannels') || '[]');
        let activeAudioKey = localStorage.getItem('activeAudioKey') || null;
        let mediaElements = {};
        let allMuted = true;

        function saveActive() {
            localStorage.setItem('activeChannels', JSON.stringify(active));
            localStorage.setItem('activeAudioKey', activeAudioKey || '');
        }

        function buildIframeUrl(baseUrl, key, shouldHaveAudio) {
            const separator = baseUrl.includes('?') ? '&' : '?';
            // Force muted for iframe channels initially
            return `${baseUrl}${separator}autoplay=1&muted=1&controls=1`;
        }

        function updateMediaAudio(key, shouldHaveAudio) {
            const element = mediaElements[key];
            if (!element) return;

            const ch = channels[key];
            try {
                if (ch.type === 'hls') {
                    element.muted = !shouldHaveAudio;
                } else if (ch.type === 'iframe') {
                    // For iframe channels, we can't easily control audio
                    // The muted parameter in URL might not work for all sources
                    if (shouldHaveAudio) {
                        console.log(`Audio enabled for ${key} (iframe - limited control)`);
                    } else {
                        console.log(`Audio should be muted for ${key} (iframe - limited control)`);
                    }
                }
            } catch (error) {
                console.log(`Could not control audio for ${key}:`, error);
            }
        }

        function updateAllAudio() {
            allMuted = !activeAudioKey;
            
            active.forEach(key => {
                const shouldHaveAudio = (key === activeAudioKey);
                updateMediaAudio(key, shouldHaveAudio);
                
                const container = document.querySelector(`[data-channel="${key}"]`);
                if (container) {
                    if (shouldHaveAudio) {
                        container.classList.add('has-audio');
                    } else {
                        container.classList.remove('has-audio');
                    }
                }
            });
            
            // Update mute all button
            if (allMuted) {
                muteAllBtn.classList.add('all-muted');
                muteAllBtn.innerHTML = '<i class="fas fa-volume-mute"></i> הכל מושתק';
            } else {
                muteAllBtn.classList.remove('all-muted');
                muteAllBtn.innerHTML = '<i class="fas fa-volume-up"></i> השתק הכל';
            }
        }

        function updateGrid() {
            grid.className = `grid-container grid-${active.length || 1}`;
            grid.innerHTML = '';
            mediaElements = {};

            if (active.length === 0) {
                noChannelMessage.style.display = 'block';
                activeAudioKey = null;
            } else {
                noChannelMessage.style.display = 'none';

                active.forEach(key => {
                    const ch = channels[key];
                    const wrapper = document.createElement('div');
                    wrapper.className = 'video-container';
                    wrapper.dataset.channel = key;

                    // Add audio indicator
                    const audioIndicator = document.createElement('div');
                    audioIndicator.className = 'audio-indicator';
                    audioIndicator.innerHTML = '<i class="fas fa-volume-up"></i> <span>שמע פעיל</span>';
                    wrapper.appendChild(audioIndicator);

                    // Add channel name
                    const channelName = document.createElement('div');
                    channelName.className = 'channel-name';
                    channelName.textContent = ch.name;
                    wrapper.appendChild(channelName);

                    let mediaElement;
                    const shouldHaveAudio = (key === activeAudioKey);

                    if (ch.type === 'hls') {
                        mediaElement = document.createElement('video');
                        mediaElement.className = 'w-full h-full';
                        mediaElement.autoplay = true;
                        mediaElement.controls = true;
                        mediaElement.muted = true; // Start muted
                        mediaElement.playsinline = true;
                        wrapper.appendChild(mediaElement);

                        if (Hls.isSupported()) {
                            const hls = new Hls();
                            hls.loadSource(ch.url);
                            hls.attachMedia(mediaElement);
                            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                                mediaElement.muted = !shouldHaveAudio;
                            });
                        } else if (mediaElement.canPlayType('application/vnd.apple.mpegurl')) {
                            mediaElement.src = ch.url;
                            mediaElement.muted = !shouldHaveAudio;
                        }
                    } else {
                        mediaElement = document.createElement('iframe');
                        mediaElement.className = 'w-full h-full';
                        mediaElement.src = buildIframeUrl(ch.url, key, shouldHaveAudio);
                        mediaElement.allow = 'autoplay; fullscreen';
                        mediaElement.frameBorder = '0';
                        mediaElement.sandbox = 'allow-scripts allow-same-origin allow-presentation';
                        wrapper.appendChild(mediaElement);
                    }

                    mediaElements[key] = mediaElement;

                    wrapper.addEventListener('click', () => {
                        if (activeAudioKey === key) {
                            activeAudioKey = null;
                        } else {
                            activeAudioKey = key;
                        }
                        saveActive();
                        updateAllAudio();
                    });

                    grid.appendChild(wrapper);
                });
            }
            
            updateAllAudio();
        }

        // Mute all button functionality
        muteAllBtn.addEventListener('click', () => {
            if (allMuted) {
                // If all muted, don't enable any audio (keep all muted)
                activeAudioKey = null;
            } else {
                // If some audio is playing, mute all
                activeAudioKey = null;
            }
            saveActive();
            updateAllAudio();
        });

        // Channel button functionality
        buttons.forEach(btn => {
            const key = btn.dataset.channel;
            if (active.includes(key)) {
                btn.classList.add('active');
            }

            btn.addEventListener('click', () => {
                if (active.includes(key)) {
                    active = active.filter(x => x !== key);
                    btn.classList.remove('active');
                    if (activeAudioKey === key) {
                        activeAudioKey = null;
                    }
                } else {
                    active = [key, ...active.filter(x => x !== key)];
                    btn.classList.add('active');
                }
                saveActive();
                updateGrid();
            });
        });

        // Initialize
        updateGrid();
    </script>

    <div class="footer-container text-center">
        <div class="mb-6">
            <p class="text-gray-300 mb-4">גם תחנות רדיו להאזנה:</p>
            <a href="https://mistralnet.github.io/radio" class="footer-link-button" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-radio"></i>
                תחנות רדיו
            </a>
        </div>
        
        <div class="flex justify-center flex-wrap gap-4 mb-6 text-sm">
            <a href="https://mistralnet.github.io/radio/" target="_blank" class="text-blue-400 hover:text-blue-300">Radio</a>
            <a href="https://mistralnet.github.io/radio/tv.html" target="_blank" class="text-blue-400 hover:text-blue-300">TV</a>
            <a href="https://mistralnet.github.io/radio/tv2.html" target="_blank" class="text-blue-400 hover:text-blue-300">TV2</a>
            <a href="https://mistralnet.github.io/radio/tv3.html" target="_blank" class="text-blue-400 hover:text-blue-300">TV3</a>
            <a href="https://mistralnet.github.io/radio/tv4.html" target="_blank" class="text-blue-400 hover:text-blue-300">TV4</a>
        </div>
        
        <div class="text-gray-400 text-sm">
            גרסה 5.1 - TV משופר עם בקרת שמע מתוקנת
        </div>
    </div>
</body>
</html>

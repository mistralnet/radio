<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רדיו באינטרנט עם Chromecast</title>
    <style>
        .station-button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #cast-button {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 50%;
            cursor: pointer;
        }
        #mode-toggle {
            position: fixed;
            top: 60px;
            right: 10px;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="cast-button"></div>
    <div id="mode-toggle" onclick="toggleMode()">האזן בדפדפן</div>

    <button class="station-button" id="station-kan" data-url="https://28503.live.streamtheworld.com/KAN_BET.mp3?dist=radio2net">
        <img src="kan_logo.png" alt="כאן ב'">
    </button>
    <button class="station-button" id="station-glz" data-url="https://glzwizzlv.bynetcdn.com/glz_mp3?awCollectionId=misc&awEpisodeId=glz">
        <img src="glz_logo.png" alt="גלי צהל">
    </button>
    <button class="station-button" id="glyisrael" data-url="https://cdn.cybercdn.live/Galei_Israel/Live/icecast.audio">
        <img src="glyisrael_logo.png" alt="גלי ישראל">
    </button>

    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
    <script>
        let currentStationUrl = '';
        let currentAudio = null;
        let castContext = null;
        let isCasting = false;

        // Initialize Cast SDK
        function initializeCastApi() {
            cast.framework.CastContext.getInstance().setOptions({
                receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
                autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
            });
            castContext = cast.framework.CastContext.getInstance();
        }

        // Function to stop current playback
        function stopPlayback() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            if (isCasting) {
                const castSession = castContext.getCurrentSession();
                if (castSession) {
                    castSession.endSession(true);
                }
                isCasting = false;
            }
        }

        // Function to cast the current station
        function castStation() {
            if (!currentStationUrl) {
                alert('בחר תחנה תחילה');
                return;
            }

            const castSession = castContext.getCurrentSession();
            if (!castSession) {
                alert('לא נמצא מכשיר Chromecast');
                return;
            }

            const mediaInfo = new chrome.cast.media.MediaInfo(currentStationUrl, 'audio/mp3');
            const request = new chrome.cast.media.LoadRequest(mediaInfo);
            castSession.loadMedia(request).then(
                () => {
                    console.log('שידור החל בהצלחה');
                    isCasting = true;
                },
                (error) => console.error('שגיאה בהפעלת השידור:', error)
            );
        }

        // Function to play locally
        function playLocally() {
            if (!currentStationUrl) {
                alert('בחר תחנה תחילה');
                return;
            }
            stopPlayback();
            currentAudio = new Audio(currentStationUrl);
            currentAudio.play();
        }

        // Toggle between local and Chromecast mode
        function toggleMode() {
            const modeToggle = document.getElementById('mode-toggle');
            if (modeToggle.textContent === 'האזן בדפדפן') {
                modeToggle.textContent = 'שדר ל-Chromecast';
                stopPlayback();
            } else {
                modeToggle.textContent = 'האזן בדפדפן';
                stopPlayback();
            }
        }

        // Add event listeners to station buttons
        document.querySelectorAll('.station-button').forEach(button => {
            button.addEventListener('click', () => {
                currentStationUrl = button.getAttribute('data-url');
                const modeToggle = document.getElementById('mode-toggle');
                if (modeToggle.textContent === 'האזן בדפדפן') {
                    playLocally();
                } else {
                    castStation();
                }
            });
        });

        // Add event listener to cast button
        document.getElementById('cast-button').addEventListener('click', castStation);

        // Initialize Cast API when the script loads
        window.onload = initializeCastApi;
    </script>
</body>
</html>

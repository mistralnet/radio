<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רדיו עם תמיכה בכרומקאסט</title>
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    <script>
        let session = null;
        let currentAudio = new Audio();
        let isCasting = false;

        function checkCastAvailability() {
            if (!window.cast || !window.chrome || !chrome.cast) {
                console.error("Chromecast API not available yet.");
                setTimeout(checkCastAvailability, 1000);
                return;
            }
            initializeCastApi();
        }

        function initializeCastApi() {
            cast.framework.CastContext.getInstance().setOptions({
                receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
                autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
            });
        }

        function playLocally(url) {
            if (currentAudio.src !== url) {
                currentAudio.src = url;
            }
            currentAudio.play();
        }

        function stopLocalPlayback() {
            currentAudio.pause();
            currentAudio.src = "";
        }

        function launchCast(url) {
            const context = cast.framework.CastContext.getInstance();
            context.requestSession().then(session => {
                const mediaInfo = new chrome.cast.media.MediaInfo(url, 'audio/mp3');
                mediaInfo.contentType = 'audio/mp3';
                const request = new chrome.cast.media.LoadRequest(mediaInfo);
                session.loadMedia(request).catch(error => console.error("Error loading media: ", error));
                isCasting = true;
            }).catch(error => console.error("Failed to start session: ", error));
        }

        function togglePlayback(url) {
            if (isCasting) {
                stopLocalPlayback();
                launchCast(url);
            } else {
                playLocally(url);
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            checkCastAvailability();
            document.querySelectorAll(".station-button").forEach(button => {
                button.addEventListener("click", () => {
                    const url = button.getAttribute("data-url");
                    togglePlayback(url);
                });
            });

            document.getElementById("toggle-cast").addEventListener("click", () => {
                isCasting = !isCasting;
                alert(isCasting ? "מעבר לשידור בכרומקאסט" : "מעבר לשידור מקומי");
            });
        });
    </script>
</head>
<body>
    <button id="toggle-cast">החלף בין כרומקאסט לשידור מקומי</button>
    <button class="station-button" id="station-kan" data-url="https://28503.live.streamtheworld.com/KAN_BET.mp3?dist=radio2net">
        <img src="kan_logo.png" alt="כאן ב'">
    </button>
    <button class="station-button" id="station-glz" data-url="https://glzwizzlv.bynetcdn.com/glz_mp3?awCollectionId=misc&awEpisodeId=glz">
        <img src="glz_logo.png" alt="גלי צהל">
    </button>
    <button class="station-button" id="glyisrael" data-url="https://cdn.cybercdn.live/Galei_Israel/Live/icecast.audio">
        <img src="glyisrael_logo.png" alt="גלי ישראל">
    </button>
</body>
</html>

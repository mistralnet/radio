<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>אפליקציית תחנות רדיו</title>
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?load=YOUR_APP_ID"></script>
    <style>
        /* סגנונות לעיצוב הכפתור */
        #cast-button {
            margin-top: 20px;
            background-color: #FF5722;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        #cast-button:disabled {
            background-color: #BDBDBD;
        }
    </style>
</head>
<body>
    <div class="container">
        <audio id="audio-player" controls>
            <source src="http://kanliveicy.media.kan.org.il/kanbet_mp3" type="audio/mpeg">
            הדפדפן שלך לא תומך בהשמעת אודיו.
        </audio>

        <button id="cast-button" disabled>התחבר לכרוםקאסט</button>
    </div>

    <script>
        // משתנים גלובליים עבור הכרוםקאסט
        let castSession = null;

        // פונקציה שמבצעת חיבור למכשיר כרוםקאסט
        function onCastApiAvailable(isAvailable) {
            if (isAvailable) {
                document.getElementById('cast-button').disabled = false;
            }
        }

        function initializeCastApi() {
            cast.framework.CastContext.getInstance().setOptions({
                receiverApplicationId: 'YOUR_APP_ID',
                autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
            });

            cast.framework.CastContext.getInstance().addEventListener(
                cast.framework.CastContextEventType.CAST_STATE_CHANGED,
                function(event) {
                    if (event.castState === cast.framework.CastState.CONNECTED) {
                        console.log('מכשיר כרוםקאסט מחובר');
                        castSession = cast.framework.CastContext.getInstance().getCurrentSession();
                    }
                }
            );
        }

        // פונקציה שמחברת את השמע למכשיר כרוםקאסט
        function castToChromecast() {
            if (castSession) {
                const mediaInfo = new chrome.cast.media.MediaInfo('http://kanliveicy.media.kan.org.il/kanbet_mp3', 'audio/mp3');
                const request = new chrome.cast.media.LoadRequest(mediaInfo);
                castSession.loadMedia(request, 
                    function() {
                        console.log('התחלה מוצלחת של השמע בכרוםקאסט');
                    }, 
                    function(error) {
                        console.error('שגיאה בהתחלת השמע בכרוםקאסט', error);
                    }
                );
            }
        }

        document.getElementById('cast-button').addEventListener('click', castToChromecast);

        // אתחול ה-API של כרוםקאסט
        if (window.cast && window.cast.isAvailable) {
            initializeCastApi();
        } else {
            document.getElementById('cast-button').disabled = true;
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>נגן רדיו</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/castjs/5.2.0/cast.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f5f5f5;
        }
        
        .player-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .station-name {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #333;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .button-row {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .volume-control {
            width: 100%;
            margin: 1rem 0;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
        }

        #status-message {
            margin-top: 1rem;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="station-name">כאן ב</div>
        
        <div class="controls">
            <div class="button-row">
                <button id="playButton">נגן</button>
                <button id="stopButton">עצור</button>
            </div>
            
            <div class="volume-control">
                <input type="range" id="volumeSlider" min="0" max="100" value="100">
            </div>

            <div class="button-row">
                <button id="castButton">שדר ל-Chromecast</button>
                <button id="stopCastButton" disabled>עצור שידור</button>
            </div>
        </div>

        <div id="status-message"></div>
    </div>

    <script>
        const STREAM_URL = 'https://28503.live.streamtheworld.com/KAN_BET.mp3?dist=radio2net';
        
        // Initialize audio elements
        const audio = new Audio();
        audio.src = STREAM_URL;
        
        // Initialize Chromecast
        const cast = new Cast();
        
        // UI Elements
        const playButton = document.getElementById('playButton');
        const stopButton = document.getElementById('stopButton');
        const volumeSlider = document.getElementById('volumeSlider');
        const castButton = document.getElementById('castButton');
        const stopCastButton = document.getElementById('stopCastButton');
        const statusMessage = document.getElementById('status-message');

        // Local playback controls
        playButton.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playButton.textContent = 'השהה';
            } else {
                audio.pause();
                playButton.textContent = 'נגן';
            }
        });

        stopButton.addEventListener('click', () => {
            audio.pause();
            audio.currentTime = 0;
            playButton.textContent = 'נגן';
        });

        volumeSlider.addEventListener('input', (e) => {
            const volume = e.target.value / 100;
            audio.volume = volume;
            if (cast.connected) {
                cast.volume(volume);
            }
        });

        // Chromecast controls
        castButton.addEventListener('click', async () => {
            if (!cast.connected) {
                statusMessage.textContent = 'מתחבר ל-Chromecast...';
                try {
                    await cast.connect();
                    await cast.cast(STREAM_URL);
                    audio.pause();
                    playButton.textContent = 'נגן';
                    castButton.disabled = true;
                    stopCastButton.disabled = false;
                    statusMessage.textContent = 'מחובר ל-Chromecast';
                } catch (error) {
                    statusMessage.textContent = 'שגיאה בחיבור ל-Chromecast';
                    console.error('Chromecast error:', error);
                }
            }
        });

        stopCastButton.addEventListener('click', () => {
            if (cast.connected) {
                cast.disconnect();
                castButton.disabled = false;
                stopCastButton.disabled = true;
                statusMessage.textContent = '';
            }
        });

        // Handle Chromecast connection events
        cast.on('connect', () => {
            statusMessage.textContent = 'מחובר ל-Chromecast';
            castButton.disabled = true;
            stopCastButton.disabled = false;
        });

        cast.on('disconnect', () => {
            statusMessage.textContent = '';
            castButton.disabled = false;
            stopCastButton.disabled = true;
        });

        // Handle errors
        audio.onerror = () => {
            statusMessage.textContent = 'שגיאה בטעינת השידור';
        };
    </script>
</body>
</html>

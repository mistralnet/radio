<!DOCTYPE html>
<html lang="he">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רדיו כאן ב</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        #app {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        #volume-controls {
            margin-top: 10px;
        }

        #volume-slider {
            width: 100px;
        }

        #cast-status {
            margin-top: 10px;
            font-style: italic;
            color: #777;
        }
    </style>
</head>

<body>
    <div id="app">
        <h1>רדיו כאן ב</h1>
        <audio id="audioPlayer" src="https://28503.live.streamtheworld.com/KAN_BET.mp3?dist=radio2net" controls
            preload="none"></audio>
        <div id="volume-controls">
            <label for="volume-slider">עוצמת שמע:</label>
            <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1">
        </div>
        <button id="playButton">הפעל</button>
        <button id="pauseButton">עצור</button>
        <button id="castButton">העבר ל-Chromecast</button>
        <p id="cast-status"></p>
        <p>גרסה: 2.0</p>
        <p>נוצר בתאריך: 6/6/2024 שעה: 16:30</p>
    </div>

    <script>
        const audioPlayer = document.getElementById('audioPlayer');
        const playButton = document.getElementById('playButton');
        const pauseButton = document.getElementById('pauseButton');
        const volumeSlider = document.getElementById('volume-slider');
        const castButton = document.getElementById('castButton');
        const castStatus = document.getElementById('cast-status');

        playButton.addEventListener('click', () => {
            audioPlayer.play();
        });

        pauseButton.addEventListener('click', () => {
            audioPlayer.pause();
        });

        volumeSlider.addEventListener('input', () => {
            audioPlayer.volume = volumeSlider.value;
        });

        castButton.addEventListener('click', castMedia);

        function castMedia() {
            castStatus.textContent = "מחפש Chromecast...";

            // Check if Cast is available
            if (typeof chrome.cast === 'undefined' || !chrome.cast || !chrome.cast.isAvailable) {
                castStatus.textContent = "Chromecast לא זמין, מנסה לאתחל שוב...";
                setTimeout(() => {
                    initializeCastApi(); // Try to initialize again after a delay
                }, 1000);
                return;
            }

            launchApp();
        }
        let session = null;

        function initializeCastApi() {
            castStatus.textContent = "מאתחל API...";

            // Check if chrome.cast and chrome.cast.SessionRequest are defined
            if (typeof chrome.cast === 'undefined' || typeof chrome.cast.SessionRequest === 'undefined') {
                castStatus.textContent = "שגיאה: chrome.cast או chrome.cast.SessionRequest לא מוגדרים.";
                return;
            }

            const sessionRequest = new chrome.cast.SessionRequest(chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID);
            const apiConfig = new chrome.cast.ApiConfig(sessionRequest,
                sessionListener,
                receiverListener);

            chrome.cast.initialize(apiConfig, onInitSuccess, onError);
        }

        function onInitSuccess() {
            castStatus.textContent = "אתחול הצליח!";
        }

        function onError(message) {
            castStatus.textContent = "שגיאה: " + message;
        }

        function sessionListener(newSession) {
            castStatus.textContent = 'מחובר ל-Chromecast!';
            session = newSession;
            loadMedia();
        }

        function receiverListener(receiver) {
            castStatus.textContent = 'התקבל רסיבר: ' + receiver.friendlyName;
        }

        function launchApp() {
            chrome.cast.requestSession(
                function (newSession) {
                    session = newSession;
                    castStatus.textContent = 'אפליקציה הושקה.';
                    loadMedia();
                },
                function (err) {
                    castStatus.textContent = 'שגיאת השקה: ' + err.message;
                }
            );
        }

        function loadMedia() {
            if (!session) {
                castStatus.textContent = 'אין סשן פעיל.';
                return;
            }

            castStatus.textContent = 'טוען מדיה...';
            const mediaInfo = new chrome.cast.media.MediaInfo(
                'https://28503.live.streamtheworld.com/KAN_BET.mp3?dist=radio2net',
                'audio/mp3');
            mediaInfo.streamType = chrome.cast.media.StreamType.LIVE;

            const request = new chrome.cast.media.LoadRequest(mediaInfo);
            session.loadMedia(request,
                function () {
                    castStatus.textContent = 'מדיה נטענה בהצלחה ב-Chromecast!';
                },
                function (err) {
                    castStatus.textContent = 'שגיאת טעינה: ' + err.message;
                });
        }

        // Initialize Cast API after the page has loaded
        window.onload = function () {
            castStatus.textContent = "טוען Chromecast API...";
            if (typeof chrome.cast !== 'undefined' && chrome.cast && chrome.cast.isAvailable) {
                initializeCastApi();
            } else {
                castStatus.textContent = "Chromecast לא זמין, נסה שוב מאוחר יותר. ממתין לזמינות...";
                setTimeout(function () {
                    initializeCastApi();
                }, 3000);
            }
        };
    </script>
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>

</body>

</html>

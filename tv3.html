<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>צפייה בערוצים</title>
  <!-- Google Analytics Script -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J5WT91REYB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J5WT91REYB');
  </script>
  <!-- HLS.js Library for HLS streams -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <!-- Tailwind CSS CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* הגדרות בסיסיות לגוף הדף */
    body {
      background: #1F2937; /* רקע כהה */
      color: white; /* טקסט לבן */
      font-family: 'Inter', sans-serif; /* פונט נקי */
      margin: 0;
    }

    /* קונטיינר לוידאו - יחס גובה-רוחב קבוע, פינות מעוגלות */
    .video-container {
      position: relative;
      aspect-ratio: 16/9; /* יחס 16:9 לוידאו */
      border-radius: 8px; /* פינות מעוגלות */
      overflow: hidden; /* הסתרת תוכן שיוצא מגבולות */
    }

    /* קונטיינר לכפתורי שליטה (השתק/מסך מלא) */
    .controls-container {
      position: absolute;
      top: 50%;
      left: 12px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-start;
      z-index: 10; /* ודא שהפקדים נמצאים מעל הוידאו */
      opacity: 0; /* כברירת מחדל הכפתורים עמומים */
      transition: opacity 0.3s ease; /* אנימציה חלקה למעבר שקיפות */
    }

    /* הצגת כפתורי השליטה במעבר עכבר/מגע */
    .video-container:hover .controls-container,
    .video-container.touch-active .controls-container { /* 'touch-active' for mobile touch */
      opacity: 1; /* הצג את הכפתורים במעבר עכבר */
    }

    /* פס שם הערוץ העליון */
    .channel-name-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7); /* רקע שקוף למחצה */
      color: white;
      padding: 4px 10px;
      text-align: center;
      font-size: 0.85rem;
      border-bottom-left-radius: 8px;
      border-bottom-right-radius: 8px;
      opacity: 0; /* כברירת מחדל עמום */
      transition: opacity 0.3s ease; /* אנימציה חלקה למעבר שקיפות */
      z-index: 10; /* מעל הוידאו */
    }

    /* הצגת פס שם הערוץ במעבר עכבר/מגע */
    .video-container:hover .channel-name-bar,
    .video-container.touch-active .channel-name-bar {
      opacity: 1;
    }

    /* סגנון כללי לכפתורי סאונד ומסך מלא */
    .sound-toggle, .fullscreen-toggle {
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.6); /* רקע שקוף למחצה */
      padding: 8px 16px;
      border-radius: 10px; /* פינות מעוגלות יותר */
      cursor: pointer; /* סמן עכבר כהצבעה */
      font-size: 0.9rem;
      min-width: 90px;
      text-align: center;
      transition: 0.2s ease; /* אנימציית מעבר קצרה */
      color: white;
    }

    /* צבעים לכפתור סאונד בהתאם למצב */
    .sound-toggle.on { background: #10B981; } /* ירוק כשהסאונד פעיל */
    .sound-toggle.off { background: #EF4444; } /* אדום כשהסאונד מושתק */

    /* צבעים לכפתור מסך מלא בהתאם למצב */
    .fullscreen-toggle { background: #4B5563; } /* אפור כהה */
    .fullscreen-toggle.active { background: #4F46E5; } /* כחול-סגול כשהמסך מלא פעיל */

    /* סגנון כפתורי בחירת ערוץ */
    .channel-button {
       padding: 10px 20px;
       border-radius: 8px;
       background: #4B5563; /* אפור כהה */
       transition: 0.2s; /* אנימציית מעבר קצרה */
       font-weight: bold;
       display: flex;
       align-items: center;
       gap: 8px; /* רווח בין אייקון לטקסט */
    }
    .channel-button:hover { background: #6B7280; } /* רקע כהה יותר במעבר עכבר */
    .channel-button.active { background: #1F6FEB; transform: translateY(-2px); } /* כחול כשהערוץ פעיל, עם אפקט קטן */

    /* מדיה קוואריס לרשת וידאו - למסכים גדולים */
    @media (min-width: 768px) {
      /* הגדרת הגריד ל-3 עמודות שוות רוחב */
      #video-grid {
        grid-template-columns: repeat(3, 1fr); /* 3 עמודות שוות */
        grid-auto-rows: auto;
      }
    }
    /* לרוחב קטן יותר, הגריד יהיה עמודה אחת כפי שהוגדר ב-Tailwind: grid-cols-1 */

    /* מצב מסך מלא - הסתרת שאר הוידאוים */
    .fullscreen-mode .video-container:not(.active-fullscreen) {
      display: none !important;
    }

    /* סגנון הוידאו הפעיל במצב מסך מלא */
    .fullscreen-mode .video-container.active-fullscreen {
      position: fixed; /* קבוע במיקום המסך */
      top: 0;
      left: 0;
      width: 100vw !important; /* רוחב מסך מלא */
      height: 100vh !important; /* גובה מסך מלא */
      z-index: 9999; /* מעל הכל */
      background: #000; /* רקע שחור */
      border-radius: 0; /* ללא פינות מעוגלות */
      opacity: 0; /* התחלה משקיפות 0 */
      animation: fadeIn 0.3s ease forwards; /* אנימציית הופעה עדינה */
    }

    /* אנימציית הופעה למסך מלא */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* אנימציות החלקה בין וידאוים במצב מסך מלא */
    .slide-left {
      animation: slideLeft 0.3s ease forwards;
    }
    .slide-right {
      animation: slideRight 0.3s ease forwards;
    }
    @keyframes slideLeft {
      from { transform: translateX(100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideRight {
      from { transform: translateX(-100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body class="p-4">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P5QLH7TD" height="0" width="0" style="display:none"></iframe></noscript>

<h1 class="text-2xl font-bold text-center mb-4">צפייה בערוצים</h1>

<div class="flex justify-center gap-3 flex-wrap mb-6" id="channel-buttons">
  <button class="channel-button" data-channel="kan11">כאן 11</button>
  <button class="channel-button" data-channel="now14">עכשיו 14</button>
  <button class="channel-button" data-channel="i24news">i24NEWS</button>
  <button class="channel-button" data-channel="news13">חדשות 13</button>
  <button class="channel-button" data-channel="news12">חדשות 12</button>
</div>

<div id="video-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  <!-- סרטוני הערוצים יוצגו כאן על ידי JavaScript -->
</div>

<p id="no-channel-message" class="text-center text-gray-300 mt-6 hidden">יש לבחור ערוץ מהכפתורים מעלה</p>

<script>
  // הגדרת הערוצים הזמינים, כולל סוג וידאו (hls/iframe) וכתובת URL
  const channels = {
    kan11: { name: 'כאן 11', type: 'hls', url: 'https://kan11w.media.kan.org.il/hls/live/2105694/2105694/source1_4k/chunklist.m3u8' },
    now14: {
      name: 'עכשיו 14',
      type: 'iframe',
      url: 'https://snippet.univtec.com/player.html?data-insight=eyJndWlkIjoiYjY3NmI5MDYtNTYyNS00OGFmLWEzMzEtMTFhNWQyMmUxNTFiIiwidHlwZSI6ImNoYW5uZWxzIiwiYWNjb3VudElkIjoiNjM5Nzc1M2ZmZjg3MTk3YWU2YTNjMDMiLCJjbGllbnQiOiJjaGFubmVsMTQiLCJhcGkiOiJodHRwczovL2luc2lnaHQtYXBpLWNoYW5uZWwxNC51bml2dGVjLmNvbS8ifQ==',
      muteParam: 'muted' // פרמטר השתקה אם קיים בנגן iframe
    },
    i24news: { name: 'i24NEWS', type: 'hls', url: 'https://bcovlive-a.akamaihd.net/d89ede8094c741b7924120b27764153c/eu-central-1/5377161796001/profile_0/chunklist.m3u8' },
    news13: { name: 'חדשות 13', type: 'hls', url: 'https://d198ztbnlup2iq.cloudfront.net/out/v1/2d9050c90fb94df8b78d1d98306a1a65/index.m3u8' },
    news12: {
      name: 'חדשות 12',
      type: 'iframe',
      url: 'https://www.mako.co.il/AjaxPage?jspName=embedHTML5video.jsp&galleryChannelId=798cfb1e06667910VgnVCM200000650a10acRCRD&videoChannelId=7690b3a2a4ac5910VgnVCM200000650a10acRCRD&vcmid=003432e70df02310VgnVCM100000290b320aRCRD',
      muteParam: 'muted'
    }
  };

  // משתני מצב גלובליים
  let active = []; // רשימת הערוצים הפעילים (שנבחרו לצפייה)
  let activeAudioKey = null; // מזהה הערוץ הפעיל עם שמע
  let fullscreenKey = null; // מזהה הערוץ שנמצא כרגע במסך מלא
  let lastDirection = null; // עוקב אחר כיוון ההחלקה/חץ למטרת אנימציה

  // אלמנטים מה-DOM
  const grid = document.getElementById('video-grid');
  const message = document.getElementById('no-channel-message');
  const channelButtonsContainer = document.getElementById('channel-buttons');

  /**
   * בונה כתובת URL ל-iframe עם פרמטרים של השתקה.
   * פרמטר autoplay הוסר מכיוון שהוא מטופל ע"י allow="autoplay" ב-iframe.
   * @param {string} base - כתובת ה-URL הבסיסית.
   * @param {boolean} muted - האם להשתיק את הוידאו.
   * @param {string} muteParam - שם הפרמטר לשליטה בהשתקה ב-URL.
   * @returns {string} כתובת URL מעודכנת.
   */
  function buildUrl(base, muted, muteParam = 'muted') {
    const url = new URL(base);
    // הוסף את פרמטר ההשתקה רק אם הוא מוגדר עבור הערוץ
    if (muteParam) {
      url.searchParams.set(muteParam, muted ? '1' : '0');
    }
    return url.toString();
  }

  /**
   * מפעיל או מכבה מצב מסך מלא עבור וידאו מסוים.
   * @param {string} key - מזהה הערוץ.
   */
  function toggleFullscreen(key) {
    if (fullscreenKey === key) {
      // אם כבר במסך מלא, צא ממצב מסך מלא
      fullscreenKey = null;
      document.body.classList.remove('fullscreen-mode');
      document.exitFullscreen?.(); // יציאה ממסך מלא בדפדפן
    } else {
      // אם לא במסך מלא, היכנס למצב מסך מלא
      fullscreenKey = key;
      activeAudioKey = key; // הערוץ במסך מלא תמיד יהיה עם שמע
      document.body.classList.add('fullscreen-mode');
      document.documentElement.requestFullscreen?.().catch(err => {
        console.log('Fullscreen error:', err); // הדפסת שגיאות במסך מלא
      });
    }
    render(); // רנדור מחדש של הוידאוים
  }

  /**
   * מעדכן את כפתורי בחירת הערוץ כדי להציג אינדיקטור שמע פעיל ואת הערוצים הפעילים.
   */
  function updateChannelButtons() {
    document.querySelectorAll('.channel-button').forEach(btn => {
      const key = btn.dataset.channel;
      // הסר את כל אייקוני הערוץ הקיימים (פעיל/שמע)
      btn.querySelectorAll('.channel-icon').forEach(icon => icon.remove());

      // אם הערוץ פעיל, הוסף אייקון מתאים
      if (active.includes(key)) {
        const icon = document.createElement('span');
        icon.className = 'channel-icon ml-1'; // קלאס כללי לאייקון עם רווח

        if (key === activeAudioKey) {
          icon.textContent = '🔊'; // אייקון שמע
        } else {
          icon.textContent = '✅'; // אייקון וי (פעיל)
        }
        btn.appendChild(icon); // הוסף את האייקון לכפתור
      }
    });
  }

  /**
   * מרנדר מחדש את רשת הוידאו בהתאם לערוצים הפעילים.
   */
  function render() {
    grid.innerHTML = ''; // נקה את הרשת הקיימת
    // הגדר את הגריד ל-1 עמודה במובייל, ו-3 עמודות במסכים גדולים יותר
    // זה יבטיח סימטריה בגודל לכל כמות של סרטונים (עד 3 בשורה)
    grid.className = 'grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-4';

    // הצג/הסתר הודעת "יש לבחור ערוץ"
    message.classList.toggle('hidden', active.length > 0);

    active.forEach(key => {
      const ch = channels[key];
      const box = document.createElement('div');
      // הוסף קלאס "active-fullscreen" אם הערוץ במצב מסך מלא
      box.className = `video-container ${fullscreenKey === key ? 'active-fullscreen' : ''}`;

      // הוסף קלאס אנימציה בהתאם לכיוון ההחלקה (כניסה למסך מלא)
      if (fullscreenKey === key && lastDirection) {
        box.classList.add(lastDirection === 'right' ? 'slide-left' : 'slide-right');
      }

      let el; // אלמנט הוידאו/iframe
      const hasAudio = key === activeAudioKey; // האם ערוץ זה עם שמע פעיל

      if (ch.type === 'hls') {
        // אם זה ערוץ HLS (כאן 11, i24NEWS, חדשות 13)
        el = document.createElement('video');
        el.className = 'w-full h-full';
        el.autoplay = true;
        el.controls = true;
        el.muted = !hasAudio; // השתק אם אין לו שמע פעיל

        if (Hls.isSupported()) {
          // השתמש ב-Hls.js אם נתמך
          const hls = new Hls();
          hls.loadSource(ch.url);
          hls.attachMedia(el);
        } else {
          // אחרת, השתמש בנגן ה-HTML5 המובנה
          el.src = ch.url;
        }
      } else {
        // אם זה ערוץ iframe (עכשיו 14, חדשות 12)
        el = document.createElement('iframe');
        el.className = 'w-full h-full';
        el.allow = 'autoplay; fullscreen'; // הרשאות ל-iframe

        // השתמש ב-buildUrl לכל האייפריים כדי לשלוט בהשתקה
        const muteParam = ch.muteParam || 'muted';
        el.src = buildUrl(ch.url, !hasAudio, muteParam);
      }

      // יצירת קונטיינר לכפתורי השליטה (שמע ומסך מלא)
      const controlsContainer = document.createElement('div');
      controlsContainer.className = 'controls-container';

      // יצירת פס שם הערוץ
      const channelNameBar = document.createElement('div');
      channelNameBar.className = 'channel-name-bar';
      channelNameBar.textContent = ch.name; // שם הערוץ מהאובייקט channels

      // כפתור השתקה/הפעלה של שמע - רק עבור ערוצי HLS
      if (ch.type === 'hls') {
        const soundBtn = document.createElement('button');
        soundBtn.className = `sound-toggle ${hasAudio ? 'on' : 'off'}`;
        soundBtn.textContent = hasAudio ? '🔊 השתק' : '🔇 שמע';
        soundBtn.onclick = e => {
          e.stopPropagation(); // מנע התפשטות האירוע
          activeAudioKey = hasAudio ? null : key; // שנה מצב שמע
          render(); // רנדר מחדש כדי לעדכן מצב שמע
          updateChannelButtons(); // עדכן אייקונים בכפתורים
        };
        controlsContainer.append(soundBtn);
      }

      // כפתור מסך מלא
      const fullscreenBtn = document.createElement('button');
      fullscreenBtn.className = `fullscreen-toggle ${fullscreenKey === key ? 'active' : ''}`;
      fullscreenBtn.textContent = fullscreenKey === key ? '↩️ חזרה' : '⛶ מסך מלא';
      fullscreenBtn.onclick = e => {
        e.stopPropagation(); // מנע התפשטות האירוע
        toggleFullscreen(key); // הפעל/כבה מסך מלא
      };

      // הוסף כפתורים לקונטיינר השליטה
      controlsContainer.append(fullscreenBtn); // כעת רק כפתור המסך המלא או גם השמע עבור HLS
      // הוסף את הוידאו/iframe ואת הפקדים לקופסת הוידאו
      box.append(el, controlsContainer, channelNameBar); // הוסף גם את פס שם הערוץ
      // הוסף את קופסת הוידאו לרשת הוידאו
      grid.appendChild(box);
    });

    updateChannelButtons(); // עדכן את מצב כפתורי הערוצים
  }

  // האזנה לאירועי יציאה ממסך מלא של הדפדפן
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement && fullscreenKey) {
      // אם יצאנו ממסך מלא דרך הדפדפן (לדוגמה, עם מקש ESC), עדכן את המצב ב-JS
      toggleFullscreen(null);
    }
  });

  // ניווט במצב מסך מלא באמצעות מקשי חצים
  document.addEventListener('keydown', (e) => {
    if (!fullscreenKey) return; // רק אם אנחנו במצב מסך מלא

    const idx = active.indexOf(fullscreenKey); // אינדקס הערוץ הנוכחי

    if (e.key === 'ArrowRight' && idx < active.length - 1) {
      // חץ ימינה: עבור לערוץ הבא
      lastDirection = 'right';
      fullscreenKey = active[idx + 1];
      activeAudioKey = fullscreenKey; // הערוץ החדש יהיה עם שמע
      render();
    }
    if (e.key === 'ArrowLeft' && idx > 0) {
      // חץ שמאלה: עבור לערוץ הקודם
      lastDirection = 'left';
      fullscreenKey = active[idx - 1];
      activeAudioKey = fullscreenKey; // הערוץ החדש יהיה עם שמע
      render();
    }
  });

  // ניווט במצב מסך מלא באמצעות מחוות מגע (סווייפ)
  let touchStartX = 0;
  document.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      touchStartX = e.touches[0].clientX;
      // הוסף קלאס לפעילות מגע כדי להציג פקדים במכשירי מגע
      e.target.closest('.video-container')?.classList.add('touch-active');
    }
  });
  document.addEventListener('touchend', e => {
    if (!fullscreenKey || e.changedTouches.length !== 1) return;

    const diffX = e.changedTouches[0].clientX - touchStartX;
    const idx = active.indexOf(fullscreenKey);

    if (diffX < -50 && idx < active.length - 1) {
      // סווייפ שמאלה: עבור לערוץ הבא
      lastDirection = 'right';
      fullscreenKey = active[idx + 1];
      activeAudioKey = fullscreenKey;
      render();
    }
    if (diffX > 50 && idx > 0) {
      // סווייפ ימינה: עבור לערוץ הקודם
      lastDirection = 'left';
      fullscreenKey = active[idx - 1];
      activeAudioKey = fullscreenKey;
      render();
    }
    // הסר את הקלאס touch-active לאחר אינטראקציה
    e.target.closest('.video-container')?.classList.remove('touch-active');
  });

  // ניווט במצב מסך מלא באמצעות גרירה עם העכבר
  let mouseDownX = null;
  document.addEventListener('mousedown', e => {
    if (fullscreenKey) mouseDownX = e.clientX;
  });
  document.addEventListener('mouseup', e => {
    if (!fullscreenKey || mouseDownX === null) return;

    const diffX = e.clientX - mouseDownX;
    const idx = active.indexOf(fullscreenKey);

    if (diffX < -100 && idx < active.length - 1) {
      // גרירה שמאלה: עבור לערוץ הבא
      lastDirection = 'right';
      fullscreenKey = active[idx + 1];
      activeAudioKey = fullscreenKey;
      render();
    }
    if (diffX > 100 && idx > 0) {
      // גרירה ימינה: עבור לערוץ הקודם
      lastDirection = 'left';
      fullscreenKey = active[idx - 1];
      activeAudioKey = fullscreenKey;
      render();
    }
    mouseDownX = null;
  });

  // טיפול בלחיצה על כפתורי הערוצים
  document.querySelectorAll('.channel-button').forEach(btn => {
    const key = btn.dataset.channel;
    btn.onclick = () => {
      if (active.includes(key)) {
        // אם הערוץ כבר פעיל, הסר אותו
        active = active.filter(k => k !== key);
        if (activeAudioKey === key) activeAudioKey = null; // אם הסרנו את הערוץ עם השמע, נקה
        if (fullscreenKey === key) toggleFullscreen(null); // אם הסרנו את הערוץ במסך מלא, צא ממסך מלא
        btn.classList.remove('active'); // הסר סימון פעיל מהכפתור
      } else {
        // אם הערוץ לא פעיל, הוסף אותו (במקום הראשון ברשימה)
        active.unshift(key);
        btn.classList.add('active'); // סמן את הכפתור כפעיל
      }
      render(); // רנדר מחדש את הרשת
    };
  });

  // קריאה ראשונית ל-render כדי להציג את מצב ההתחלתי (הודעת "יש לבחור ערוץ")
  render();
</script>

<footer class="mt-10 text-center text-sm text-gray-400">
  <!-- הכפתור לצפייה במסך גדול (כנראה לא בשימוש כעת, מכיוון שיש כפתור מסך מלא בכל וידאו) -->
  <button id="fullscreen-toggle" class="footer-link-button mt-2 hidden">צפייה במסך גדול</button>
  <div class="mb-2">גם תחנות רדיו להאזנה:</div>
  <a href="https://mistralnet.github.io/radio" class="inline-block bg-indigo-600 hover:bg-indigo-500 text-white py-2 px-4 rounded mb-4">🎧 תחנות רדיו</a>
  <div class="flex justify-center gap-4 flex-wrap mb-4">
    <a href="https://mistralnet.github.io/radio/" class="text-blue-400 hover:text-blue-300">Radio</a>
    <a href="https://mistralnet.github.io/radio/tv.html" class="text-blue-400 hover:text-blue-300">TV</a>
    <a href="https://mistralnet.github.io/radio/tv2.html" class="text-blue-400 hover:text-blue-300">TV2</a>
    <a href="https://mistralnet.github.io/radio/tv3.html" class="text-blue-400 hover:text-blue-300">TV3</a>
    <a href="https://mistralnet.github.io/radio/tv4.html" class="text-blue-400 hover:text-blue-300">TV4</a>
  </div>
  <div class="version-info">גרסה 6.4 - עם ניווט בין ערוצים במסך מלא ועיצוב כפתורים שמאלי</div>
</footer>
</body>
</html>

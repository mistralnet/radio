<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>צפייה בערוצים</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J5WT91REYB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-J5WT91REYB');
    </script>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
        j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-P5QLH7TD');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            direction: rtl;
            background-color: #1F2937;
            color: white;
            margin: 0;
            font-family: "Inter", sans-serif;
        }
        .video-container {
            position: relative;
            aspect-ratio: 16 / 9;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
        }
        .sound-toggle {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0,0,0,0.6);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.85rem;
            display: none;
            align-items: center;
            gap: 4px;
        }
        .video-container:hover .sound-toggle {
            display: inline-flex;
        }
        .sound-toggle.on {
            background-color: #10B981;
        }
        .sound-toggle.off {
            background-color: #EF4444;
        }
        .grid-container {
            display: grid;
            gap: 16px;
            margin: 0 auto;
            max-width: 100%;
            padding: 0 16px;
        }
        .channel-button {
            padding: 12px 24px;
            background-color: #4B5563;
            color: white;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.2s;
            flex: 1 1 120px;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .channel-button.active {
            background-color: #1F6FEB;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }
        .channel-button:hover {
            background-color: #6B7280;
            transform: translateY(-2px);
        }
        @media (min-width: 768px) {
            .grid-1 { grid-template-columns: 1fr; }
            .grid-2 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(3, 1fr); }
            .grid-4 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, auto); }
            .grid-5 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, auto); }
        }
        @media (max-width: 767px) {
            .grid-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
        }
        .footer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px 16px;
            margin-top: 40px;
            background-color: #2D3748;
            border-top: 1px solid #4A5568;
            border-radius: 8px;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
        }
        .footer-link-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .footer-link-button {
            background-color: #6366F1;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .footer-link-button:hover {
            background-color: #4F46E5;
            transform: translateY(-1px);
        }
        .footer-text {
            color: #CBD5E0;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 10px;
        }
        .version-info {
            color: #9CA3AF;
            font-size: 0.85rem;
        }
        .no-channel-message {
            text-align: center;
            color: #CBD5E0;
            margin-top: 20px;
            font-size: 1.1rem;
            font-weight: 500;
        }
    </style>
</head>
<body class="p-4">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P5QLH7TD" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<h1 class="text-2xl font-bold mb-4 text-center">צפייה בערוצים</h1>
<div class="text-center mb-4 text-sm text-gray-300">בחר ערוצים:</div>

<div class="flex justify-center gap-3 flex-wrap mb-8 max-w-screen-lg mx-auto">
    <button class="channel-button" data-channel="kan11">כאן 11</button>
    <button class="channel-button" data-channel="now14">עכשיו 14</button>
    <button class="channel-button" data-channel="i24news">i24NEWS</button>
    <button class="channel-button" data-channel="news13">חדשות 13</button>
    <button class="channel-button" data-channel="news12">חדשות 12</button>
</div>

<div id="video-grid" class="grid-container"></div>
<div id="no-channel-message" class="no-channel-message" style="display: none;">יש לבחור ערוץ מהכפתורים מעלה</div>

<script>
const channels = {
    kan11: { type: 'hls', url: 'https://kan11w.media.kan.org.il/hls/live/2105694/2105694/source1_4k/chunklist.m3u8' },
    now14: { type: 'iframe', url: 'https://snippet.univtec.com/player.html?data-insight=eyJndWlkIjoiYjY3NmI5MDYtNTYyNS00OGFmLWEzMzEtMTFhNWQyMmUxNTFiIiwidHlwZSI6ImNoYW5uZWxzIiwiYWNjb3VudElkIjoiNjM5Nzc1M2ZmZjg3MTk3YWU2YTNjMDMiLCJjbGllbnQiOiJjaGFubmVsMTQiLCJhcGkiOiJodHRwczovL2luc2lnaHQtYXBpLWNoYW5uZWwxNC51bml2dGVjLmNvbS8ifQ==' },
    i24news: { type: 'hls', url: 'https://bcovlive-a.akamaihd.net/d89ede8094c741b7924120b27764153c/eu-central-1/5377161796001/profile_0/chunklist.m3u8' },
    news13: { type: 'hls', url: 'https://d198ztbnlup2iq.cloudfront.net/out/v1/2d9050c90fb94df8b78d1d98306a1a65/index.m3u8' },
    news12: { type: 'iframe', url: 'https://www.mako.co.il/AjaxPage?jspName=embedHTML5video.jsp&galleryChannelId=798cfb1e06667910VgnVCM200000650a10acRCRD&videoChannelId=7690b3a2a4ac5910VgnVCM200000650a10acRCRD&vcmid=003432e70df02310VgnVCM100000290b320aRCRD' }
};

const grid = document.getElementById('video-grid');
const buttons = document.querySelectorAll('.channel-button');
let active = JSON.parse(localStorage.getItem('activeChannels') || '[]');
let activeAudioKey = null;
let mediaElements = {};
const noChannelMessage = document.getElementById('no-channel-message');

function saveActive() {
    localStorage.setItem('activeChannels', JSON.stringify(active));
}

function buildIframeUrl(baseUrl, key, shouldHaveAudio) {
    const separator = baseUrl.includes('?') ? '&' : '?';
    return `${baseUrl}${separator}autoplay=1&muted=${shouldHaveAudio ? '0' : '1'}`;
}

function updateMediaAudio(key, shouldHaveAudio) {
    const element = mediaElements[key];
    const ch = channels[key];

    if (!element) return;

    if (ch.type === 'hls') {
        element.muted = !shouldHaveAudio;
    } else if (ch.type === 'iframe') {
        const newUrl = buildIframeUrl(ch.url, key, shouldHaveAudio);
        if (element.src !== newUrl) {
            element.src = newUrl;
        }
    }

    const toggleBtn = document.querySelector(`.sound-toggle[data-key="${key}"]`);
    if (toggleBtn) {
        toggleBtn.textContent = shouldHaveAudio ? '🔊 השתק' : '🔇 שמע';
        toggleBtn.className = `sound-toggle ${shouldHaveAudio ? 'on' : 'off'}`;
    }
}

function updateAllAudio() {
    active.forEach(key => {
        const shouldHaveAudio = (key === activeAudioKey);
        updateMediaAudio(key, shouldHaveAudio);
    });
}

function createSoundToggleButton(key) {
    const btn = document.createElement('button');
    btn.className = 'sound-toggle off';
    btn.dataset.key = key;
    btn.textContent = '🔇 שמע';
    btn.onclick = (e) => {
        e.stopPropagation();
        activeAudioKey = activeAudioKey === key ? null : key;
        updateAllAudio();
    };
    return btn;
}

function updateGrid() {
    grid.className = `grid-container grid-${active.length || 1}`;
    grid.innerHTML = '';
    mediaElements = {};

    if (active.length === 0) {
        noChannelMessage.style.display = 'block';
        activeAudioKey = null;
    } else {
        noChannelMessage.style.display = 'none';

        active.forEach(key => {
            const ch = channels[key];
            const wrapper = document.createElement('div');
            wrapper.className = 'video-container';
            wrapper.dataset.channel = key;

            let mediaElement;
            const shouldHaveAudio = (key === activeAudioKey);

            if (ch.type === 'hls') {
                mediaElement = document.createElement('video');
                mediaElement.className = 'w-full h-full rounded-md';
                mediaElement.autoplay = true;
                mediaElement.controls = true;
                mediaElement.muted = !shouldHaveAudio;
                wrapper.appendChild(mediaElement);

                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(ch.url);
                    hls.attachMedia(mediaElement);
                } else {
                    mediaElement.src = ch.url;
                }
            } else {
                mediaElement = document.createElement('iframe');
                mediaElement.className = 'w-full h-full rounded-md';
                mediaElement.src = buildIframeUrl(ch.url, key, shouldHaveAudio);
                mediaElement.allow = 'autoplay; fullscreen';
                mediaElement.frameBorder = '0';
                wrapper.appendChild(mediaElement);
            }

            mediaElements[key] = mediaElement;
            wrapper.appendChild(createSoundToggleButton(key));

            wrapper.addEventListener('click', () => {
                activeAudioKey = activeAudioKey === key ? null : key;
                updateAllAudio();
            });

            grid.appendChild(wrapper);
        });
    }
}

buttons.forEach(btn => {
    const key = btn.dataset.channel;
    if (active.includes(key)) {
        btn.classList.add('active');
    }

    btn.onclick = () => {
        if (active.includes(key)) {
            active = active.filter(x => x !== key);
            btn.classList.remove('active');
            if (activeAudioKey === key) activeAudioKey = null;
        } else {
            active = [key, ...active.filter(x => x !== key)];
            btn.classList.add('active');
        }
        saveActive();
        updateGrid();
    };
});

updateGrid();
</script>

<div class="footer-container">
    <div class="footer-link-group">
        <p class="footer-text">גם תחנות רדיו להאזנה:</p>
        <a href="https://mistralnet.github.io/radio" rel="noopener noreferrer" class="footer-link-button">🎧 תחנות רדיו</a>
        <button id="fullscreen-toggle" class="footer-link-button mt-2">צפייה במסך גדול</button>
    </div>
    <div class="menu-container">
        <div class="menu">
            <a href="https://mistralnet.github.io/radio/">Radio</a>
            <a href="https://mistralnet.github.io/radio/tv.html">TV</a>
            <a href="https://mistralnet.github.io/radio/tv2.html">TV2</a>
            <a href="https://mistralnet.github.io/radio/tv3.html">TV3</a>
            <a href="https://mistralnet.github.io/radio/tv4.html">TV4</a>
        </div>
    </div>
    <div class="version-info">גרסה 4.3 TV3</div>
</div>

<script>
document.getElementById('fullscreen-toggle').addEventListener('click', () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().then(() => {
            fullscreenToggle.textContent = 'חזור לתצוגה קודמת';
        });
    } else {
        document.exitFullscreen().then(() => {
            fullscreenToggle.textContent = 'צפייה במסך גדול';
        });
    }
});

document.addEventListener('fullscreenchange', () => {
    const fullscreenToggle = document.getElementById('fullscreen-toggle');
    if (!document.fullscreenElement) {
        fullscreenToggle.textContent = 'צפייה במסך גדול';
    } else {
        fullscreenToggle.textContent = 'חזור לתצוגה קודמת';
    }
});
</script>
    <div class="footer-container text-center">
        <div class="mb-6">
            <p class="text-gray-300 mb-4">גם תחנות רדיו להאזנה:</p>
            <a href="https://mistralnet.github.io/radio" class="footer-link-button" rel="noopener noreferrer">
                <i class="fas fa-radio"></i>
                תחנות רדיו
            </a>
        </div>
        
        <div class="flex justify-center flex-wrap gap-4 mb-6 text-sm">
            <a href="https://mistralnet.github.io/radio/" class="text-blue-400 hover:text-blue-300">Radio</a>
            <a href="https://mistralnet.github.io/radio/tv.html"   class="text-blue-400 hover:text-blue-300">TV</a>
            <a href="https://mistralnet.github.io/radio/tv2.html"  class="text-blue-400 hover:text-blue-300">TV2</a>
            <a href="https://mistralnet.github.io/radio/tv3.html"  class="text-blue-400 hover:text-blue-300">TV3</a>
            <a href="https://mistralnet.github.io/radio/tv4.html"   class="text-blue-400 hover:text-blue-300">TV4</a>
        </div>
                <div class="iframe-warning">
            <i class="fas fa-info-circle"></i>
            <span>הערה: ערוץ 12 ועכשיו 14 עשויים להתחיל עם שמע למרות הגדרות השתקה בגלל מגבלות טכניות</span>
        </div>
    </div>

        <div class="text-gray-400 text-sm">
            גרסה 5.1 - TV משופר עם בקרת שמע מתוקנת
        </div>
    </div>
</body>
</html>

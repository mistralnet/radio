<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>יישום רדיו עם כרומקאסט</title>
    <script src="https://www.gstatic.com/cast/sdk/libs/cast.framework/3.3.0/cast_framework.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: center;
            padding: 20px;
        }

        .station-btn {
            margin: 10px;
            padding: 10px;
            font-size: 18px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }

        .station-btn:disabled {
            background-color: #ccc;
        }

        #error-message {
            color: red;
            font-size: 18px;
            margin-top: 20px;
            display: none;
        }

        #status-message {
            font-size: 18px;
            margin-top: 20px;
        }

        #chromecast-btn {
            background-color: #ff5722;
        }
    </style>
</head>
<body>

<h1>רדיו עם כרומקאסט</h1>
<p>בחר תחנה:</p>

<button class="station-btn" id="station-kan">כאן ב'</button>
<button class="station-btn" id="station-glz">גלי צה"ל</button>
<button class="station-btn" id="glyisrael">גלי ישראל</button>

<button class="station-btn" id="chromecast-btn" disabled>לחץ לחיבור כרומקאסט</button>

<p id="status-message">מצב: לא מנגן</p>
<p id="error-message"></p>

<audio id="audioPlayer" controls style="display:none;"></audio>

<script>
    const stations = {
        "station-kan": "https://28503.live.streamtheworld.com/KAN_BET.mp3?dist=radio2net",
        "station-glz": "https://glzwizzlv.bynetcdn.com/glz_mp3?awCollectionId=misc&awEpisodeId=glz",
        "glyisrael": "https://cdn.cybercdn.live/Galei_Israel/Live/icecast.audio"
    };

    const audioPlayer = document.getElementById('audioPlayer');
    const chromecastBtn = document.getElementById('chromecast-btn');
    const statusMessage = document.getElementById('status-message');
    const errorMessage = document.getElementById('error-message');

    let currentStation = null;
    let castSession = null;

    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
    }

    function clearError() {
        errorMessage.textContent = '';
        errorMessage.style.display = 'none';
    }

    function playStation(stationId) {
        currentStation = stationId;
        audioPlayer.src = stations[stationId];
        audioPlayer.play();
        statusMessage.textContent = "מצב: מנגן במכשיר";
        chromecastBtn.disabled = false;
    }

    function startChromecast() {
        if (!window.cast || !cast.framework || !cast.framework.CastContext.getInstance().getCurrentSession()) {
            showError("לא נמצא כרומקאסט זמין ברשת.");
            statusMessage.textContent = "מצב: לא מנגן";
            return;
        }

        const castContext = cast.framework.CastContext.getInstance();
        castContext.requestSession().then(function (session) {
            castSession = session;
            castSession.loadMedia(new cast.framework.media.LoadRequest({
                media: {
                    contentId: stations[currentStation],
                    contentType: 'audio/mp3',
                    streamType: cast.framework.media.StreamType.BUFFERED
                }
            }));
            statusMessage.textContent = "מצב: מנגן בכרומקאסט";
        }).catch(function () {
            showError("לא הצלחנו להתחבר לכרומקאסט.");
            statusMessage.textContent = "מצב: לא מנגן";
        });
    }

    function stopChromecast() {
        if (castSession) {
            castSession.stop();
            statusMessage.textContent = "מצב: מנגן במכשיר";
        }
    }

    document.getElementById('station-kan').addEventListener('click', function() {
        playStation('station-kan');
    });

    document.getElementById('station-glz').addEventListener('click', function() {
        playStation('station-glz');
    });

    document.getElementById('glyisrael').addEventListener('click', function() {
        playStation('glyisrael');
    });

    chromecastBtn.addEventListener('click', function() {
        if (castSession) {
            stopChromecast();
        } else {
            startChromecast();
        }
    });

    window.onload = function() {
        cast.framework.CastContext.getInstance().setOptions({
            receiverApplicationId: 'CC1AD845',
            autoJoinPolicy: cast.framework.CastContext.AutoJoinPolicy.ORIGIN_SCOPED
        });
    };
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רדיו עם כרומקאסט</title>
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>רדיו</h1>
    <button onclick="playStation('https://28503.live.streamtheworld.com/KAN_BET.mp3?dist=radio2net')">כאן ב'</button>
    <button onclick="playStation('https://glzwizzlv.bynetcdn.com/glz_mp3?awCollectionId=misc&awEpisodeId=glz')">גלי צה"ל</button>
    <button onclick="playStation('https://cdn.cybercdn.live/Galei_Israel/Live/icecast.audio')">גלי ישראל</button>
    
    <br>
    <button onclick="toggleCast()">שלח לכרומקאסט</button>
    <button onclick="stopCast()">עצור כרומקאסט</button>
    <br>
    <button onclick="changeVolume(-0.1)">🔉</button>
    <button onclick="changeVolume(0.1)">🔊</button>
    
    <p id="status">בחר תחנה להפעלה</p>
    
    <audio id="audio" controls style="width: 100%; margin-top: 10px;"></audio>
    
    <script>
        let audio = document.getElementById("audio");
        let castSession = null;
        let media = null;
        let currentStation = "";

        function playStation(url) {
            currentStation = url;
            if (castSession) {
                loadMedia(url);
                document.getElementById("status").innerText = "מנגן בכרומקאסט";
            } else {
                audio.src = url;
                audio.play();
                document.getElementById("status").innerText = "מנגן במכשיר";
            }
        }
        
        function toggleCast() {
            if (!castSession) {
                chrome.cast.requestSession(session => {
                    castSession = session;
                    loadMedia(currentStation);
                }, error => console.log("Error: ", error));
            } else {
                loadMedia(currentStation);
            }
        }

        function loadMedia(url) {
            if (!castSession) return;
            let mediaInfo = new chrome.cast.media.MediaInfo(url, "audio/mp3");
            let request = new chrome.cast.media.LoadRequest(mediaInfo);
            castSession.loadMedia(request, function(media) {
                document.getElementById("status").innerText = "מנגן בכרומקאסט";
            }, function(error) { console.log("Error loading media: ", error); });
        }
        
        function stopCast() {
            if (castSession) {
                castSession.stop(() => {
                    castSession = null;
                    document.getElementById("status").innerText = "מנגן במכשיר";
                }, error => console.log("Error stopping cast: ", error));
            }
        }
        
        function changeVolume(delta) {
            if (castSession && castSession.media) {
                let newVolume = castSession.media.volume.level + delta;
                newVolume = Math.min(1, Math.max(0, newVolume));
                let volumeRequest = new chrome.cast.media.VolumeRequest(newVolume);
                castSession.media.setVolume(volumeRequest, null, null);
            } else {
                audio.volume = Math.min(1, Math.max(0, audio.volume + delta));
            }
        }
    </script>
</body>
</html>
